= Consumer Driven Contracts - a workshop
Oliver Nautsch <oliver.nautsch@nautsch.com>
2017
:author:
ifndef::imagesdir[:imagesdir: images]
ifndef::address-sourcedir[:address-sourcedir: ../../../../address-service]
ifndef::invoice-sourcedir[:invoice-sourcedir: ../../../../invoice-service]
:menu:
:goto:
:scale:
:help:
:toc:
:status:
:blank:
:figure-caption!:

== Introduction

Let's exercise, hack and talk about

*Consumer Driven* Contracts.

image::service-example.png[consumer - communicate - producer]

== Exercise-01 - Run the test

* checkout repo `git@github.com:ollin/cdc-workshop.git`
* cd into `cdc-workshop`
* run `./gradlew check` (on windows: `./gradlew.bat check`)

== Project Overview

image::service-overview.png[projects - producer - consumer]

== Directory Structure

----
✔ ~/dev/src/github.com/ollin/cdc-workshop [master|✚ 2]
15:59 $ tree -L 2
.
├── address-service     # <-- producer
│   ├── build
│   ├── build.gradle
│   ├── README.adoc
│   └── src
├── build.gradle        # <-- build file for both
├── gradle
│   └── wrapper
├── gradlew
├── gradlew.bat
├── invoice-service     # <-- consumer
│   ├── build
│   ├── build.gradle
│   ├── README.adoc
│   ├── src
│   └── target
├── out
│   └── production
├── presentation
│   ├── build
│   ├── build.gradle
│   └── src
├── README.adoc
└── settings.gradle
----

== Consumers test

[source,java]
.cdc-workshop/invoice-service/src/test/java/net/nautsch/invoice/adapters/address/AddressServiceAdapterTest.java
----
...
include::{invoice-sourcedir}/src/test/java/net/nautsch/invoice/adapters/address/AddressServiceAdapterTest.java[tags=shouldDeliverAnAddress]
...
----

== Exercise-02 - Add street

The Consumer needs a street value

Add the field "street" as an expected result.

Run the tests.

Let's discuss.

== Exercise-03 - Tolerant pact-Tests

[source,java]
.net.nautsch.address.Addresses
----
...
include::{address-sourcedir}/src/main/java/net/nautsch/address/Addresses.java[tags=Addresses]
...
----

Change the production code! _Jan Wloka_ to _Bernd Wloka_.

Whats wrong with the _address_ acceptance test? Fix it!

.Source: https://martinfowler.com/bliki/TestPyramid.html
image::test-pyramid.png[test pyramid]

Why does the pact test works?

Run the tests.

Let's discuss.

== Exercise-04 - Split the teams

.known dependencies
image::more-services.draw.io.png[known dependencies]

== The end

Thx!!!